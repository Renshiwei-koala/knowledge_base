

# 问题



1. mybatisplus批量插入数据报错：                      

   ==ERROR c.x.e.handler.GlobalExceptionHandler - nested exception is org.apache.ibatis.executor.ExecutorException: Error getting generated key or setting result to parameter object. Cause: java.lang.NullPointerException==

   ```java
   xiaoyun_notice- 2020-07-14 20:34:09 [http-nio-9001-exec-1] INFO  c.x.api.controller.ObjectController - 【新增通知：step02-object_user批量新增，维护中间表】： userId: 2
   xiaoyun_notice- 2020-07-14 20:34:09 [http-nio-9001-exec-1] INFO  jdbc.sqltiming - batching 3 statements: 1: INSERT INTO object_user ( obj_id, user_id ) VALUES ( 151, 1 ) 2: 
   INSERT INTO object_user ( obj_id, user_id ) VALUES ( 151, 2 ) 3: INSERT INTO object_user ( 
   obj_id, user_id ) VALUES ( 151, 3 ) ;
    {executed in 75 msec}
   xiaoyun_notice- 2020-07-14 20:34:09 [http-nio-9001-exec-1] INFO  jdbc.sqltiming - getGeneratedKeys on query: INSERT INTO object_user ( obj_id, user_id ) VALUES ( 151, 3 ) ;
    {executed in 0 msec}
   xiaoyun_notice- 2020-07-14 20:34:09 [http-nio-9001-exec-1] ERROR c.x.e.handler.GlobalExceptionHandler - nested exception is org.apache.ibatis.executor.ExecutorException: Error getting generated key or setting result to parameter object. Cause: java.lang.NullPointerException
   org.mybatis.spring.MyBatisSystemException: nested exception is org.apache.ibatis.executor.ExecutorException: Error getting generated key or setting result to parameter object. Cause: java.lang.NullPointerException
   ```


博客总结：https://blog.csdn.net/qq_42937522/article/details/107744928

2. 前端传给后端时间类型的数据又出问题了？   date和LocalDateTime都不行

   ```java
   ERROR c.x.e.handler.GlobalExceptionHandler - org.springframework.validation.BeanPropertyBindingResult: 1 errors
   Field error in object 'insertObjectDTO' on field 'endTime': rejected value [2020-7-15 15:15:15]; codes [typeMismatch.insertObjectDTO.endTime,typeMismatch.endTime,typeMismatch.java.util.Date,typeMismatch]; arguments [org.springframework.context.support.DefaultMessageSourceResolvable: codes [insertObjectDTO.endTime,endTime]; arguments []; default message [endTime]]; default message [Failed to convert property value of type 'java.lang.String' to required type 'java.util.Date' for property 'endTime'; nested exception is org.springframework.core.convert.ConversionFailedException: Failed to convert from type [java.lang.String] to type [@io.swagger.annotations.ApiModelProperty java.util.Date] for value '2020-7-15 15:15:15'; nested exception is java.lang.IllegalArgumentException]
   org.springframework.validation.BindException: org.springframework.validation.BeanPropertyBindingResult: 1 errors
   ```

   ![image-20200715112425544](https://gitee.com/koala010/typora/raw/master/img/image-20200715112425544.png)

解决：

添加@DateTimeFormat注解，格式化springmvc的request的参数请求格式

```java
@DateTimeFormat(pattern = "yyyy-MM-dd HH:mm:ss")
```

3. 封装BOjson序列化异常：

   ```java
   ERROR c.x.e.handler.GlobalExceptionHandler - Type definition error: [simple type, class org.apache.ibatis.executor.loader.javassist.JavassistProxyFactory$EnhancedResultObjectProxyImpl]; nested exception is com.fasterxml.jackson.databind.exc.InvalidDefinitionException: No serializer found for class org.apache.ibatis.executor.loader.javassist.JavassistProxyFactory$EnhancedResultObjectProxyImpl and no properties discovered to create BeanSerializer (to avoid exception, disable SerializationFeature.FAIL_ON_EMPTY_BEANS) (through reference chain: com.xiaoyun.response.ResponseResult["data"]->com.xiaoyun.api.bo.ObjectDetailsBO_$$_jvst744_0["handler"])
   
   ```

   解决：

   BO类上加注解：  `@JsonIgnoreProperties(value = {"handler"})`

   一般由封装BO继承DO，又进行mybatis级联查询，返回的json格式错误，作用是在 json 序列化时忽略 bean 中的一些不需要转化的属性

   总结博客：https://blog.csdn.net/qq_42937522/article/details/107745826

4. 后端返回给前端json数据反斜杠转义问题

![image-20200715120732264](https://gitee.com/koala010/typora/raw/master/img/image-20200715120732264.png)





5.

[ERROR] Failed to execute goal org.apache.maven.plugins:maven-compiler-plugin:3.8.0:compile (default-compile) on project xiaoyun_system: Compilation failure
[ERROR] /project/sign-up-api-java/xiaoyun_system/src/main/java/com/xiaoyun/api/mapper/ObjectUserMapper.java:[11,28] package javafx.scene.control does not exist
[ERROR] -> [Help 1]

![image-20200718201955694](https://gitee.com/koala010/typora/raw/master/img/image-20200719221528340.png)

环境配置问题

6. docker 中使用nginx 容器无法启动（原来 nginx 容器启动成功了，但里面的nginx 服务不自己启动，非要手动去启动

https://blog.csdn.net/chyin1024/article/details/86495188

nginx -c     执行启动的配置文件

博客总结:https://blog.csdn.net/qq_42937522/article/details/107590942

7. git忽略不掉imi文件，需要重新进行文件跟踪

https://www.cnblogs.com/coce/p/9138902.html

清除缓存

博客总结：https://blog.csdn.net/qq_42937522/article/details/107744472

8.  参数找不到

![image-20200719221528340](https://gitee.com/koala010/typora/raw/master/img/image-20200718201955694.png)

体会到了，开发中规范化的重要性

9. springboot+swagger2 TypeError: Failed to fetch

![image-20200720105814922](https://gitee.com/koala010/typora/raw/master/img/image-20200720105814922.png)

配置swagger的host

10. Navicat连接mysql出现1251Client does not support authentication protocol requested by server的解决方案

    ![image-20200721090424833](https://gitee.com/koala010/typora/raw/master/img/image-20200721090424833.png)

2059 Authentication plugin 'caching_sha2_password' cannot

![image-20200721091346831](https://gitee.com/koala010/typora/raw/master/img/image-20200721091346831.png)

```mysql
ALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password BY 'yourPassword';

use mysql;

select user,host,plugin,authentication_string from user;

alter user 'root'@'%' identified with mysql_native_password by 'yourPassword';

flush privileges;

select user,host,plugin,authentication_string from user;
```

博客总结地址：https://blog.csdn.net/qq_42937522/article/details/107740582



11. docker容器进行了挂载，但是文件目录

![image-20200721210841878](https://gitee.com/koala010/typora/raw/master/img/image-20200721210841878.png)

纯属对linux的文件目录的理解问题，原来~指的是root用户的目录，/才指的是最顶级的根目录，是文件目录挂载错了。应该将==/root/images/xiaoyun==的目录挂载进容器



12. 截止时间更新的没问题，但是每次查询就会出错。

    ![image-20200722084523133](https://gitee.com/koala010/typora/raw/master/img/image-20200722084523133.png)

不知道什么时候设置了，自动维护时间



13. mybatisplus竟然不能填充自定义的sql的创建时间和更新时间，我是按照创建时间降序

```java
/**
     * description: 新增通知时，维护中间表，批量新增
     *
     * @param objId   通知id
     * @param userIds 用户id集合
     * @return 执行条数
     * @author RenShiWei
     * Date: 2020/7/14 21:52
     */
    @Insert({
            "<script>",
            "INSERT INTO object_user(obj_id, user_id,created_at,updated_at) values ",
            "<foreach collection='userIds' item='item' index='index' separator=','>",
            "(#{objId}, #{item},now(),now())",
            "</foreach>",
            "</script>"
    })
    int saveObjectUserList ( int objId, List<Integer> userIds );
```

原因：存到数据库里的是空的！！！！！！   当然不能降序

14. java图片上传，windows下没有问题，但在linux服务器上报空指针


![image-20200723102930876](https://gitee.com/koala010/typora/raw/master/img/image-20200723102930876.png)



无法存储文件..... linux系统

错误原因：

在进行图片文件验证时，将MultipartFile和File进行了转换，中间出现了问题。

```java
/**
 * MultipartFile转File
 */
public static File toFile ( MultipartFile multipartFile ) {
    // 获取文件名
    String fileName = multipartFile.getOriginalFilename();
    // 获取文件后缀
    String prefix = "." + getExtensionName(fileName);
    File file = null;
    try {
        // 用uuid作为文件名，防止生成的临时文件重复
        file = File.createTempFile(IdUtil.simpleUUID(), prefix);
        // MultipartFile to File
        multipartFile.transferTo(file);
    } catch (IOException e) {
        e.printStackTrace();
    }
    return file;
}
```

创建临时文件的情况下，是在当前目录下也就是，



使用流的方式，判断文件类型

```java
/**
     * description: 通过byte(hutool工具包的方法)，判断文件是不是图片
     *
     * @param multipartFile 前端文件
     * @return boolean
     * @author RenShiWei
     * Date: 2020/7/22 22:08
     */
    private static boolean verifyImageByByte ( MultipartFile multipartFile ) {
        String image = "bmp dib pcp dif wmf gif jpg tif eps psd cdr iff tga pcd mpt png jpeg";
//        File file = toFile(multipartFile);
        String type = null;
        try {
            type = FileTypeUtil.getType(multipartFile.getInputStream());
        } catch (IOException e) {
            e.printStackTrace();
        }
        //再转回multipartFile，防止linux上传图片如果参数类型是multipartFile，上传失败
//        toMultiPartFile(file);
        assert type != null;
        return image.contains(type);
    }
```



